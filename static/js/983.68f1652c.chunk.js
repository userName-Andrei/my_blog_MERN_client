(self.webpackChunkmy_blog_mern_client=self.webpackChunkmy_blog_mern_client||[]).push([[983],{191:function(e,t,n){"use strict";var r=n(9439),a=n(2791);t.Z=function(e){var t=(0,a.useState)({}),n=(0,r.Z)(t,2),o=n[0],i=n[1],s=(0,a.useState)(""),l=(0,r.Z)(s,2),c=l[0],d=l[1],u=new FileReader;return{onChangePreview:function(e){i(e.target.files[0]),u.readAsDataURL(e.target.files[0]),u.onloadend=function(){d(u.result)}},onDeletePreview:function(){i({}),d(""),e.current.value=""},preview:o,previewURL:c,setPreviewURL:d}}},6560:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n(2791),a=n(6871),o=n(9434),i=n(9195),s=n(2797),l=n(4695),c=n(9790),d=n(266),u=n(890),p=n(3767),v=n(4554),m=n(6151),f=n(7665),x=n(1720),g="AddPost_preview__ZIZwx",h="AddPost_editor__GItmA",w=(n(3178),n(3123)),_=n(191),Z=n(184),j=function(){var e,t=(0,o.I0)(),n=(0,o.v9)((function(e){return e.auth.user})),j=(0,o.v9)((function(e){return{name:e.posts.posts.status,message:e.posts.posts.errorMessage}})),C=(0,a.s0)(),b=(0,r.useRef)(),y=(0,_.Z)(b),P=y.onChangePreview,R=y.onDeletePreview,k=y.setPreviewURL,U=y.preview,I=y.previewURL,S=-1!==(0,a.TH)().pathname.indexOf("add-post")?"add-post":"edit",A=(0,a.UO)().id,D=s.Ry({title:s.Z_().trim().required("\u041f\u043e\u043b\u0435 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c"),text:s.Z_().min(10,"\u041c\u0438\u043d\u0438\u043c\u0443\u043c 10 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432").trim().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435")}).required(),L=(0,i.cI)({resolver:(0,l.X)(D),defaultValues:{title:"",text:"",tags:[]},mode:"onChange"}),q=L.reset,F=L.setValue,T=L.getValues,V=L.handleSubmit,H=L.control,M=L.formState.errors,N=(0,r.useMemo)((function(){return{spellChecker:!1,maxHeight:"300px",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442",status:!1,autosave:{enable:!0,delay:1e3}}}),[]);(0,r.useEffect)((function(){n?(t((0,w.U9)()),"edit"!==S||t((0,w.vp)(A)).then((function(e){var t=e.payload,r=t.text,a=t.tags,o=t.title,i=t.previewUrl,s=t.author;k(i),F("title",o),F("text",r),F("tags",a),n._id!==s._id&&(console.log("userData._id - ".concat(n._id),"post.author._id - ".concat(s._id)),C("/"))}))):C("/")}),[]);var O=(0,r.useCallback)((function(e){F("text",e)}),[]);return(0,Z.jsxs)(d.Z,{maxWidth:"sm",sx:{mt:15,mb:4},children:["error"===j.name&&(0,Z.jsx)(u.Z,{variant:"h4",color:"error",textAlign:"center",gutterBottom:!0,children:j.message||"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."}),"error"!==j.name&&(0,Z.jsx)("form",{onSubmit:V((function(e){var n=new FormData;for(var r in e)n.append("".concat(r),e[r]);n.append("preview",U),"add-post"!==S?t((0,w.CP)({postId:A,data:n})).then((function(e){R(),F("tags",[]),q(),C("/posts/".concat(e.payload._id))})):t((0,w.qb)(n)).then((function(e){R(),F("tags",[]),q(),C("/posts/".concat(e.payload._id))}))})),children:(0,Z.jsxs)(p.Z,{spacing:2,children:[(0,Z.jsxs)(p.Z,{direction:"row",spacing:2,children:[(0,Z.jsxs)(v.Z,{sx:{display:"flex",flex:"1 0 50%"},children:[(0,Z.jsx)(m.Z,{variant:"contained",component:"label",endIcon:(0,Z.jsx)(x.Z,{}),color:I?"error":"secondary",onClick:function(){return I?R():b.current.click()},sx:{alignSelf:"flex-start"},children:I?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u0435\u0432\u044c\u044e":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u0440\u0435\u0432\u044c\u044e"}),(0,Z.jsx)("input",{name:"preview",ref:b,onChange:P,type:"file",accept:"image/jpeg, image/jpg,image/png",hidden:!0,multiple:!0})]}),(0,Z.jsx)(v.Z,{sx:{flex:"1 0 50%"},children:I&&(0,Z.jsx)("img",{src:I,className:g,alt:"preview"})})]}),(0,Z.jsx)(i.Qr,{control:H,name:"title",render:function(e){var t,n=e.field,r=n.onChange,a=n.value;return(0,Z.jsx)(f.Z,{variant:"standard",label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0441\u0442\u0430\u0442\u044c\u0438",color:"secondary",value:a,onChange:r,maxRows:3,error:M.title,helperText:null===(t=M.title)||void 0===t?void 0:t.message,multiline:!0,autoFocus:!0})}}),(0,Z.jsx)(i.Qr,{control:H,name:"tags",render:function(e){var t,n=e.field,r=n.onChange,a=n.value;return(0,Z.jsx)(f.Z,{variant:"standard",name:"tags",label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u0433\u0438 \u043a \u0441\u0442\u0430\u0442\u044c\u0435",color:"secondary",value:a,onChange:r,error:M.title,helperText:M.title?"".concat(null===(t=M.title)||void 0===t?void 0:t.message):"\u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e",multiline:!0})}}),(0,Z.jsx)(c.ZP,{className:h,value:T("text"),options:N,onChange:O}),M.text&&(0,Z.jsx)(u.Z,{variant:"caption",color:"error",children:null===(e=M.text)||void 0===e?void 0:e.message}),(0,Z.jsx)(m.Z,{variant:"contained",color:"secondary",type:"submit",children:"add-post"===S?"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c":"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0442\u044c"})]})})]})}},2562:function(){}}]);
//# sourceMappingURL=983.68f1652c.chunk.js.map